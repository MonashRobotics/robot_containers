ARG DEBIAN_FRONTEND=noninteractive

# Update package information and install necessary dependencies
RUN apt-get update && apt-get install -y lsb-release curl
# Echo the Bash script into a file inside the container

RUN echo '#!/bin/bash \n\
    lookup_ros_version() { \n\
    \tcase $1 in \n\
    \t\t"focal") echo "noetic" ;; \n\
    \t\t"bionic") echo "melodic" ;; \n\
    \t\t"xenial") echo "kinetic" ;; \n\
    \t\t"trusty") echo "indigo" ;; \n\
    \t\t*) echo "Unsupported Ubuntu version" ;; \n\
    \tesac \n\
    } \n\
    ubuntu_version=$(lsb_release -sc) \n\
    export ROS_VERSION=$(lookup_ros_version "$ubuntu_version")\
    ' >> version.sh && \
    chmod +x version.sh

RUN . ./version.sh && \
    sh -c 'echo "deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main" > /etc/apt/sources.list.d/ros-latest.list' && \
    curl -s https://raw.githubusercontent.com/ros/rosdistro/master/ros.asc | apt-key add - && \
    apt-get update && \
    apt-get install ros-$ROS_VERSION-desktop-full && \
    apt-get install python-rosdep && \
    rosdep init && rosdep update && \
    echo "source /opt/ros/$ROS_VERSION/setup.bash" >> ~/.bashrc

# Install additional dependencies
RUN apt-get install -y \
    python-rosinstall \
    python-rosinstall-generator \
    python-wstool \
    build-essential

# Clean up
RUN apt-get clean && rm -rf /var/lib/apt/lists/*